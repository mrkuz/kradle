# Kradle

## Changelog

### Version ${kradleVersion} (${new Date().format("yyyy-MM-dd")})

- Add support for [Kover](https://github.com/Kotlin/kotlinx-kover)
- Add new task `analyzeTestCoverage`
- __Defaults change__: Use Kover for test coverage instead of JaCoCo in all presets
- __Defaults change__: Don't create JaCoCo report automatically after test
- Add JaCoCo option `excludes` to exclude test tasks from analysis
- Add `mainClass` and `gitBranch` to project properties
- Add option `standardStreams` for tests
- Set environment variables `PROJECT_DIR` and `PROJECT_ROOT_DIR` when running tests
- Remove access to unit test classes for integration and functional tests
- Add new task `runTests`
- Add `useArchUnit` and `useTestcontainers`
- Fix support for target JVM 8
- Fix benchmarks for pure Java projects
- Fix `buildImage` in combination with `startupScript` or `withJvmKill` (first image created was missing extra files)
- Fix: Don't overwrite existing _App.kt_ or _App.java_ file on `bootstrap`
- Add option to disable `uberJar`, linters and code analysis tools
- Add alternative syntax for JUnit Jupiter

  Before

    ```kotlin
    kradle {
        jvm {
            test {
                withJunitJupiter("5.8.2")
            }
        }
    }
    ```

  After

    ```kotlin
    kradle {
        jvm {
            test {
                // junitJupiter()
                // junitJupiter(true)
                // junitJupiter.enable()
                // junitJupiter.enable { ... }
                junitJupiter {
                    version("5.8.2")
                }
            }
        }
    }
    ```

- Move JaCoCo configuration to `codeCoverage`

  Before

    ```kotlin
    kradle {
        jvm {
            test {
                withJacoco("0.8.7")
            }
        }
    }
    ```

  After

    ```kotlin
    kradle {
        jvm {
            codeCoverage {
                jacoco {
                    version("0.8.7")
                }
            }
        }
    }
    ```

### Version 2.1.0 (2022-01-06)

- Support for [Java development](README.md#feature-java) (linting, code analysis, bootstrapping, preview features)
- Fix `dev` in combination with Gradle toolchains
- ktlint rules are configurable
- __Defaults change__:  ktlint rule 'no-wildcard-imports' no longer disabled (it still is disabled in presets)
- Add [`customTests`](README.md#feature-test) option
- Add `kradleDump` task for diagnostics
- Exclude beta versions in `showDependencyUpdates`
- Add option `ignoreFailures` for linting and code analysis
- Files ending with `Spec` are recognized as tests
- Add alternative configuration syntax for ktlint and detekt

  Before

    ```kotlin
    kradle {
        jvm {
            kotlin {
                lint {
                    ktlintVersion("0.43.2")
                }
                codeAnalysis {
                    detektConfigFile("detekt-config.yml")
                    detektVersion("1.19.0")
                }
            }
        }
    }
    ```

  After

    ```kotlin
    kradle {
        jvm {
            kotlin {
                lint {
                    ktlint {
                        version("0.43.2")
                    }
                }
                codeAnalysis {
                    detekt {
                        version("1.19.0")
                        configFile("detekt-config.yml")
                    }
                }
            }
        }
    }
    ```
- More syntactic sugar:

   Before

       ```
       kradle {
           jvm {
               test {
                   withIntegrationTests(true)
                   withFunctionalTests(true)
               }
           }
       }
       ```

   After

       ```
       kradle {
           jvm {
               test {
                   integrationTests(true)
                   functionalTests(true)
               }
           }
       }
       ```

   Before

      ```
      kradle {
          jvm {
            docker {
                withAppSh(true)
                ports.add(...)
            }
          }
      }
      ```

   After

      ```
      kradle {
          jvm {
            docker {
                startupScript(true)
                ports(...)
            }
          }
      }
      ```

   Before

      ```
      kradle {
          jvm {
            codeAnalysis.enable()
          }
      }
      ```

   After

      ```
      kradle {
          jvm {
            codeAnalysis(true)
          }
      }
      ```

### Version 2.0.1 (2022-01-01)

- `kradle` now works in combination with [Gradle toolchains](https://docs.gradle.org/current/userguide/toolchains.html)
- Fix `analyzeDependencies`

### Version 2.0.0 (2021-12-29)

- Fix `bootstrap` for multi-project builds
- Fix exclusion of alpha versions and RCs in `showDependencyUpdates`
- Set default target JVM to 17
- Update plugins and dependencies
- New plugin `net.bitsandbobs.kradle`, which combines the functionality of `kradle-app` and `kradle-lib`
- New configuration DSL (see [configuration reference](README.md#configuration-reference))
- Deprecate `kradle-app` and `kradle-lib`. They still work, but won't receive any new features. Consider using `net.bitsandbobs.kradle` instead.
- __Breaking change__: [`disable`](https://github.com/mrkuz/kradle/tree/v1.2.0#blueprints) for `kradle-app` and `kradle-lib` removed

### Version 1.2.0 (2021-09-23)

- The tasks `showDependencyUpdates`, `analyzeCode`, `analyzeDependencies`, `generateDocumentation`,
  `uberJar` and `buildImage` are no longer aliases. Instead, they are independent tasks.
- Support use of `@JvmName`
- Automatically add `kotlin-reflect` to project dependencies
- __Breaking change__: `run` no longer sets `DEV_MODE=true`
- JMH and detekt versions are now configurable
- Strict JSR-305 processing
- Fix package statement of main class generated by `bootstrap`
- __Defaults change__: The JAR created by `uberJar` is no longer minimized
- __Breaking change__: Content of _build.properties_ generated by `generateBuildProperties` changed

  Before

  ```properties
  version=...
  timestamp=...
  git.commit-id=...
  ```

  After

  ```properties
  project.name=...
  project.group=...
  project.version=...
  build.timestamp=...
  git.commit-id=...
  ```

### Version 1.1.0 (2021-09-09)

- New task `bootstrap`: Bootstraps new app/lib project
- New task `dev`: Runs the application and stops it when sources change (for automatic rebuilds and restarts)
- New task `generateGitignore`: Generates _.gitignore_
- Added source sets and tasks for integration and functional tests
- module.md and package.md for Dokka can also be placed in any source directory
- Syntactic sugar: Added methods for configuration

  Before

    ```kotlin
    kradle {
        targetJvm.set("16")
    }
    ```

  After

    ```kotlin
    kradle {
        targetJvm("16")
    }
    ```

- Added configuration for main class

  Before

    ```kotlin
    application {
        mainClass.set("com.example.demo.AppKt")
    }
    ```

  After

    ```kotlin
    kradle {
        mainClass("com.example.demo.App")
    }
    ```


- Moved JaCoCo version to `tests`

  Before

    ```kotlin
    kradle {
        jacocoVersion("0.8.7")
    }
    ```

  After

    ```kotlin
    kradle {
        tests {
            jacocoVersion("0.8.7")
        }
    }
    ```
